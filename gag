-- ⚠ Chạy trên Roblox executor
-- Cấu hình
local targetName = "TênNgườiNhận" -- Người sẽ nhận pet
local petsToTrade = {"Bee", "Koi"} -- Danh sách pet muốn gửi

-- Dịch vụ Roblox
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- RemoteEvent trong game GAG
local PetGiftingService = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("PetGiftingService")
local AcceptPetGift = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("AcceptPetGift")
local GiftPet = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("GiftPet")

-- Lấy thông tin pet
local function GetPetData(tool)
    if not tool or not tool:IsA("Tool") then return nil end
    local petUUID = tool:GetAttribute("PET_UUID")
    if not petUUID then return nil end
    return {Name = tool.Name, UUID = petUUID, Tool = tool}
end

-- Tìm pet trong inventory
local function GetPetsInInventory()
    local pets = {}
    local function scan(container)
        for _, item in pairs(container:GetChildren()) do
            if item:IsA("Tool") and item:GetAttribute("PET_UUID") then
                local petData = GetPetData(item)
                if petData then table.insert(pets, petData) end
            end
        end
    end
    if LocalPlayer.Character then scan(LocalPlayer.Character) end
    if LocalPlayer:FindFirstChild("Backpack") then scan(LocalPlayer.Backpack) end
    return pets
end

-- Lấy tên pet bỏ thông tin [weight/age]
local function GetBasePetName(fullPetName)
    local baseName = fullPetName:match("^([^%[]+)")
    return baseName and baseName:gsub("%s+$", "") or fullPetName
end

-- Kiểm tra pet có trong danh sách trade
local function IsPetInTradeList(petName)
    local base = GetBasePetName(petName)
    for _, p in pairs(petsToTrade) do
        if p == base then return true end
    end
    return false
end

-- Gửi pet cho người nhận
local function SendPet(petData, targetPlayer)
    if not petData or not targetPlayer then return false end
    PetGiftingService:FireServer("GivePet", targetPlayer)
    print("Đã gửi:", petData.Name, "cho", targetPlayer.Name)
    task.wait(0.5)
    return true
end

-- Chấp nhận quà tặng
local function AcceptGift(giftId)
    AcceptPetGift:FireServer(true, giftId)
    print("Đã nhận quà ID:", giftId)
end

-- Sự kiện nhận pet
GiftPet.OnClientEvent:Connect(function(giftId, petName, senderName)
    print("Nhận pet từ:", senderName, "-", petName)
    AcceptGift(giftId)
end)

-- Vòng lặp gửi pet
task.spawn(function()
    while task.wait(5) do
        local targetPlayer = Players:FindFirstChild(targetName)
        if targetPlayer and targetPlayer ~= LocalPlayer then
            local pets = GetPetsInInventory()
            for _, pet in pairs(pets) do
                if IsPetInTradeList(pet.Name) then
                    SendPet(pet, targetPlayer)
                end
            end
        end
    end
end)

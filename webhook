local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local setting = getgenv().setting or _G.setting
local WebhookURL = setting and setting["Webhook Url"]
if not WebhookURL then
    warn("[‚ùå] Thi·∫øu Webhook Url trong setting!")
    return
end

-- T√¨m GUI nh·∫≠n th∆∞·ªüng
local rewardGui
repeat task.wait()
    rewardGui = Player:FindFirstChild("PlayerGui") and Player.PlayerGui:FindFirstChild("CountDown")
until rewardGui and rewardGui:FindFirstChild("Frame")

local receivedFrame = rewardGui.Frame:FindFirstChild("Recieved")
if not receivedFrame then
    warn("[‚ùå] Kh√¥ng t√¨m th·∫•y khung nh·∫≠n th∆∞·ªüng!")
    return
end

local scrollingFrame = receivedFrame:FindFirstChild("ScrollingFrame")
if not scrollingFrame then
    warn("[‚ùå] Kh√¥ng t√¨m th·∫•y ScrollingFrame!")
    return
end

print("[‚úÖ] ƒê√£ v√†o khu AFK v√† t√¨m th·∫•y khung nh·∫≠n th∆∞·ªüng!")

local requestFunc =
    (syn and syn.request)
    or (http and http.request)
    or (request)
    or (fluxus and fluxus.request)
    or (krnl and krnl.request)

if not requestFunc then
    warn("[‚ùå] Kh√¥ng t√¨m th·∫•y h√†m g·ª≠i Webhook ph√π h·ª£p! Executor kh√¥ng h·ªó tr·ª£.")
    return
end

local lastItemSent = ""
local totalItemsReceived = 0  -- Bi·∫øn ƒë·∫øm t·ªïng s·ªë v·∫≠t ph·∫©m nh·∫≠n ƒë∆∞·ª£c

local function sendWebhook(itemName)
    local data = {
        username = Player.Name .. " - AFK Bot",
        embeds = {{
            title = "üéÅ V·∫≠t ph·∫©m nh·∫≠n ƒë∆∞·ª£c",
            description = "**" .. itemName .. "**",
            color = 65280
        }}
    }

    -- Th√™m th√¥ng tin t·ªïng s·ªë v·∫≠t ph·∫©m ƒë√£ nh·∫≠n v√†o webhook
    table.insert(data.embeds, {
        title = "T·ªïng v·∫≠t ph·∫©m ƒë√£ nh·∫≠n",
        description = "**" .. totalItemsReceived .. "**",
        color = 16776960  -- M√†u s·∫Øc kh√°c ƒë·ªÉ ph√¢n bi·ªát
    })

    local success, err = pcall(function()
        requestFunc({
            Url = WebhookURL,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = HttpService:JSONEncode(data)
        })
    end)

    if success then
        print("[‚úÖ] ƒê√£ g·ª≠i item:", itemName, "T·ªïng v·∫≠t ph·∫©m ƒë√£ nh·∫≠n:", totalItemsReceived)
    else
        warn("[‚ùå] L·ªói g·ª≠i webhook:", err)
    end
end

scrollingFrame.ChildAdded:Connect(function(child)
    task.wait(0.2)
    local label = child:FindFirstChild("RewardName")
    if label and label:IsA("TextLabel") then
        local itemName = label.Text
        if itemName and itemName ~= lastItemSent then
            lastItemSent = itemName
            totalItemsReceived = totalItemsReceived + 1  -- C·∫≠p nh·∫≠t t·ªïng s·ªë v·∫≠t ph·∫©m ƒë√£ nh·∫≠n
            sendWebhook(itemName)
        end
    end
end)

print("[üëÄ] ƒêang theo d√µi ph·∫ßn th∆∞·ªüng AFK...")

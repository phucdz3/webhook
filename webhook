-- ‚úÖ Script g·ª≠i Webhook AFK Reward - d√πng v·ªõi setting
-- C·∫ßn truy·ªÅn b·∫£ng setting = { ['Webhook Url'] = "..." }

return function(setting)
    local HttpService = game:GetService("HttpService")
    local Players = game:GetService("Players")
    local Player = Players.LocalPlayer

    -- L·∫•y URL t·ª´ setting
    local WebhookURL = setting and setting["Webhook Url"]
    if not WebhookURL then
        warn("[‚ùå] Thi·∫øu Webhook Url trong setting!")
        return
    end

    -- ƒê·ª£i GUI nh·∫≠n th∆∞·ªüng xu·∫•t hi·ªán
    local rewardGui
    repeat
        rewardGui = Player:FindFirstChild("PlayerGui") and Player.PlayerGui:FindFirstChild("CountDown")
        task.wait(1)
    until rewardGui and rewardGui:FindFirstChild("Frame")

    local receivedFrame = rewardGui.Frame:FindFirstChild("Recieved")
    if not receivedFrame then
        warn("[‚ùå] Kh√¥ng t√¨m th·∫•y khung nh·∫≠n th∆∞·ªüng!")
        return
    end

    print("[‚úÖ] ƒê√£ t√¨m th·∫•y giao di·ªán nh·∫≠n th∆∞·ªüng AFK!")

    local lastItemSent = ""
    local totalItems = 0

    -- T·ª± ƒë·ªông ch·ªçn h√†m g·ª≠i HTTP theo executor
    local requestFunc =
        (syn and syn.request) or
        (http and http.request) or
        (request) or
        (fluxus and fluxus.request) or
        (krnl and krnl.request)

    if not requestFunc then
        warn("[‚ùå] Kh√¥ng t√¨m th·∫•y h√†m g·ª≠i Webhook ph√π h·ª£p! Executor c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ HTTP.")
        return
    end

    -- G·ª≠i webhook
    local function sendWebhook(itemName)
        totalItems += 1
        local data = {
            username = "AFK Rewards Bot",
            embeds = {{
                title = "üéÅ Nh·∫≠n ƒë∆∞·ª£c v·∫≠t ph·∫©m m·ªõi!",
                description = string.format("‚≠êÔ∏è **%s**\nüßÆ T·ªïng s·ªë v·∫≠t ph·∫©m ƒë√£ nh·∫≠n: `%d`\nüë§ Ng∆∞·ªùi nh·∫≠n: **%s**",
                    itemName, totalItems, Player.Name),
                color = 65280
            }}
        }

        local success, err = pcall(function()
            requestFunc({
                Url = WebhookURL,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = HttpService:JSONEncode(data)
            })
        end)

        if success then
            print("[‚úÖ] ƒê√£ g·ª≠i item v·ªÅ Webhook:", itemName)
        else
            warn("[‚ùå] Webhook l·ªói:", err)
        end
    end

    -- Theo d√µi ph·∫ßn t·ª≠ m·ªõi trong ScrollingFrame
    local function onChildAdded(child)
        task.wait(0.2)
        local rewardNameLabel = child:FindFirstChild("RewardName")
        if rewardNameLabel and rewardNameLabel:IsA("TextLabel") then
            local itemName = rewardNameLabel.Text
            if itemName and itemName ~= lastItemSent then
                lastItemSent = itemName
                sendWebhook(itemName)
            end
        end
    end

    -- B·∫Øt ƒë·∫ßu theo d√µi c√°c ph·∫ßn t·ª≠ nh·∫≠n th∆∞·ªüng
    local scrollingFrame = receivedFrame:FindFirstChild("ScrollingFrame")
    if scrollingFrame then
        scrollingFrame.ChildAdded:Connect(onChildAdded)
        print("[üëÄ] ƒêang theo d√µi item trong khu AFK...")
    else
        warn("[‚ùå] Kh√¥ng t√¨m th·∫•y ScrollingFrame trong Received!")
    end
end

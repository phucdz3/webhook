-- ‚úÖ Script g·ª≠i Webhook AFK Reward - kh√¥ng c·∫ßn truy·ªÅn (setting)

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- L·∫•y Webhook t·ª´ bi·∫øn to√†n c·ª•c
local setting = getgenv().setting or _G.setting
local WebhookURL = setting and setting["Webhook Url"]

if not WebhookURL then
	warn("[‚ùå] Thi·∫øu Webhook Url trong setting!")
	return
end

-- ƒê·ª£i GUI nh·∫≠n th∆∞·ªüng xu·∫•t hi·ªán
local rewardGui
repeat
	rewardGui = Player:FindFirstChild("PlayerGui") and Player.PlayerGui:FindFirstChild("CountDown")
	task.wait(1)
until rewardGui and rewardGui:FindFirstChild("Frame")

local receivedFrame = rewardGui.Frame:FindFirstChild("Recieved")
if not receivedFrame then
	warn("[‚ùå] Kh√¥ng t√¨m th·∫•y khung nh·∫≠n th∆∞·ªüng!")
	return
end

print("[‚úÖ] ƒê√£ t√¨m th·∫•y giao di·ªán nh·∫≠n th∆∞·ªüng AFK!")

local lastItemSent = ""

-- T·ª± ƒë·ªông ch·ªçn h√†m request ph√π h·ª£p v·ªõi executor
local requestFunc =
	(syn and syn.request)
	or (http and http.request)
	or (request)
	or (fluxus and fluxus.request)
	or (krnl and krnl.request)

-- H√†m g·ª≠i webhook
local function sendWebhook(itemName)
	local data = {
		username = Player.Name .. " - AFK Bot",
		embeds = {{
			title = "üéÅ Nh·∫≠n ƒë∆∞·ª£c v·∫≠t ph·∫©m m·ªõi!",
			description = "**" .. itemName .. "**",
			color = 65280
		}}
	}

	local success, err = pcall(function()
		requestFunc({
			Url = WebhookURL,
			Method = "POST",
			Headers = {
				["Content-Type"] = "application/json"
			},
			Body = HttpService:JSONEncode(data)
		})
	end)

	if success then
		print("[‚úÖ] ƒê√£ g·ª≠i item v·ªÅ Webhook:", itemName)
	else
		warn("[‚ùå] Webhook l·ªói:", err)
	end
end

-- Theo d√µi item m·ªõi trong GUI
local scrollingFrame = receivedFrame:FindFirstChild("ScrollingFrame")
if scrollingFrame then
	scrollingFrame.ChildAdded:Connect(function(child)
		task.wait(0.1)
		local label = child:FindFirstChild("RewardName")
		if label and label:IsA("TextLabel") then
			local itemName = label.Text
			if itemName and itemName ~= lastItemSent then
				lastItemSent = itemName
				sendWebhook(itemName)
			end
		end
	end)

	print("[üëÄ] ƒêang theo d√µi item trong khu AFK...")
else
	warn("[‚ùå] Kh√¥ng t√¨m th·∫•y ScrollingFrame trong Received!")
end
